apiVersion: v1
kind: ConfigMap
metadata:
  name: udp-director-config
  namespace: starx
data:
  config.yaml: |
    # UDP Director Configuration - Multi-Port Pod Routing
    # Single token provides access to multiple ports
    # Demonstrates label and annotation filtering
    
    queryPort: 9000
    tokenTtlSeconds: 30
    sessionTimeoutSeconds: 300
    controlPacketMagicBytes: "FFFFFFFF5245534554"

    # Multi-port configuration
    dataPorts:
      - port: 7777
        protocol: "udp"
        name: "game-udp"
      - port: 27015
        protocol: "udp"
        name: "query"

    # Default endpoint - targets pods with specific labels
    defaultEndpoint:
      resourceType: "starx-pod"
      namespace: "starx"
      
      # Labels: Static configuration (server-side filtering)
      labelSelector:
        app: "starx-test"
        map: "m-tutorial"
      
      # Annotations: Dynamic operational data (client-side filtering)
      # Uncomment to filter by dynamic values
      # annotationSelector:
      #   loadPercentage: "75"
      #   status: "accepting-players"
      
      statusQuery:
        jsonPath: "status.phase"
        expectedValues:
          - "Running"

    # Resource query mapping with multi-port support
    resourceQueryMapping:
      starx-pod:
        group: ""
        version: "v1"
        resource: "pods"
        addressPath: "status.podIP"
        # Multi-port mapping - each proxy port maps to a container port
        ports:
          - name: "game-udp"
            portName: "game-udp"
          - name: "query"
            portName: "query"
